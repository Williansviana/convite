<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ch√° de Revela√ß√£o - Ser√° Isabella ou Gabriel?</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f9f0ff, #e0f7fa);
      color: #333;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 700px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeIn 0.8s forwards;
    }

    @keyframes fadeIn {
      to { opacity: 1; transform: translateY(0); }
    }

    header {
      background: linear-gradient(45deg, #ff9a9e, #62b6cb);
      color: white;
      text-align: center;
      padding: 40px 20px;
    }

    h1 {
      font-family: 'Playfair Display', serif;
      font-size: 2rem;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .details {
      padding: 20px;
      background: #fafafa;
      border-bottom: 1px solid #eee;
      font-size: 0.95rem;
      text-align: center;
      color: #555;
    }

    .details p {
      margin: 5px 0;
    }

    .form-section {
      padding: 25px;
      background: #f9f9f9;
    }

    .form-group {
      margin: 15px 0;
      text-align: left;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: #555;
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
    }

    button {
      margin-top: 15px;
      padding: 12px;
      border: none;
      border-radius: 50px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: 0.3s;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(to right, #ff6f91, #62b6cb);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
    }

    .btn-danger {
      background: #d32f2f;
      color: white;
      padding: 8px 16px;
      font-size: 0.9rem;
      border-radius: 20px;
    }

    .btn-danger:hover {
      background: #c62828;
    }

    .success {
      display: none;
      padding: 20px;
      background: #e8f5e9;
      color: #2e7d32;
      border-radius: 8px;
      margin: 20px;
      font-size: 1rem;
      text-align: center;
    }

    .guest-list {
      padding: 25px;
      background: #f8f9fa;
    }

    .guest-list h3 {
      color: #62b6cb;
      text-align: center;
      margin-bottom: 15px;
      font-size: 1.3rem;
    }

    .guest-item {
      position: relative;
      padding: 14px 12px 12px 16px;
      background: white;
      border-radius: 10px;
      margin-bottom: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      border-left: 4px solid #ff9a9e;
    }

    .guest-item strong {
      color: #e91e63;
      font-size: 1.05rem;
    }

    .edit-btn {
      position: absolute;
      top: 8px;
      right: 10px;
      background: none;
      border: none;
      font-size: 1.1rem;
      color: #7b1fa2;
      cursor: pointer;
      opacity: 0.6;
      transition: 0.2s;
    }

    .edit-btn:hover {
      opacity: 1;
      transform: scale(1.2);
    }

    .loading {
      text-align: center;
      color: #888;
      font-style: italic;
      padding: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üéâ Ch√° de Revela√ß√£o</h1>
      <p class="subtitle">Venha comemorar conosco: ser√° Isabella ou Gabriel?</p>
      <p><strong>üéÅ Ajuda com festa:</strong> Fraldas e quem beber, trazer refrigerante ou cerveja</p>
    </header>

    <div class="details">
      <p><strong>üìÖ Data:</strong> 27 de Setembro de 2025</p>
      <p><strong>‚è∞ Hor√°rio:</strong> 13h</p>
      <p><strong>üìç Local:</strong> Ch√°cara Viana - Alto da Serra de S√£o Pedro</p>
    </div>

    <!-- Formul√°rio de Confirma√ß√£o -->
    <div class="form-section" id="formSection">
      <p style="color: #e91e63; font-weight: 500; margin-bottom: 15px;">Confirme sua presen√ßa:</p>

      <div class="form-group">
        <label for="nome">Seu nome completo *</label>
        <input type="text" id="nome" placeholder="Ex: Ana Silva" required />
      </div>

      <div class="form-group">
        <label for="acompanhantes">Quem vai com voc√™?</label>
        <textarea id="acompanhantes" placeholder="Ex: meu marido e minha filha"></textarea>
      </div>

      <button id="enviarBtn" class="btn-primary">
        ‚úÖ Confirmar Presen√ßa
      </button>
      <p id="status" style="margin-top: 10px; font-size: 0.9rem; color: #d32f2f; text-align: center;"></p>
    </div>

    <!-- Mensagem de sucesso -->
    <div class="success" id="sucesso">
      <p><strong>üéâ Obrigado(a), <span id="nomeMostrado"></span>!</strong></p>
      <p>Sua presen√ßa √© um presente! Mal podemos esperar por voc√™! ‚ù§Ô∏è</p>
    </div>

    <!-- Lista de Confirmados -->
    <div class="guest-list">
      <h3>üíñ Amigos que j√° confirmaram (<span id="total">0</span>)</h3>
      <div id="listaConvidados">
        <p class="loading">Carregando amigos especiais...</p>
      </div>

      <!-- Bot√£o de Limpar com Senha -->
      <div style="text-align: center; margin: 20px 0;">
        <button id="limparBtn" class="btn-danger">üóëÔ∏è Limpar Tudo</button>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Firebase SDK - URLs corrigidas (sem espa√ßos!) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
    // üî• Configura√ß√£o do Firebase (corrigida)
    const firebaseConfig = {
      apiKey: "AIzaSyB6y6m3EbvWDJTewD9KjBRuvevhoi8___Q",
      authDomain: "cha-revelacao-702ae.firebaseapp.com",
      databaseURL: "https://cha-revelacao-702ae-default-rtdb.firebaseio.com", // ‚úÖ Sem espa√ßos
      projectId: "cha-revelacao-702ae",
      storageBucket: "cha-revelacao-702ae.firebasestorage.app",
      messagingSenderId: "715921788413",
      appId: "1:715921788413:web:1e0a1b83e11a775e4f5d94"
    };

    // Inicializa o Firebase
    try {
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();
      const ref = db.ref("confirmacoes");

      const status = document.getElementById("status");
      const lista = document.getElementById("listaConvidados");
      const total = document.getElementById("total");
      const formSection = document.getElementById("formSection");
      const sucesso = document.getElementById("sucesso");
      const enviarBtn = document.getElementById("enviarBtn");
      const nomeInput = document.getElementById("nome");
      const acompanhantesInput = document.getElementById("acompanhantes");

      let editandoId = null;

      // üî• Escuta mudan√ßas em tempo real
      ref.on("value", (snapshot) => {
        const data = snapshot.val();
        lista.innerHTML = "";
        let count = 0;

        if (data) {
          Object.keys(data).reverse().forEach(key => {
            const item = data[key];
            const div = document.createElement("div");
            div.className = "guest-item";
            div.innerHTML = `
              <strong>${item.nome}</strong>
              <div style="font-size:0.9rem; color:#666; margin-top:4px;">
                Levar√°: ${item.acompanhantes || 'Apenas eu'}
              </div>
              <button class="edit-btn" data-id="${key}" data-nome="${item.nome}" data-acompanhantes="${item.acompanhantes || ''}" title="Editar">‚úèÔ∏è</button>
            `;
            lista.appendChild(div);
            count++;
          });

          // Adiciona evento de edi√ß√£o
          document.querySelectorAll(".edit-btn").forEach(btn => {
            btn.addEventListener("click", function () {
              const id = this.getAttribute("data-id");
              const nome = this.getAttribute("data-nome");
              const acompanhantes = this.getAttribute("data-acompanhantes");

              nomeInput.value = nome;
              acompanhantesInput.value = acompanhantes;
              editandoId = id;

              enviarBtn.innerHTML = "üíæ Salvar Edi√ß√£o";
              status.textContent = "> Editando sua confirma√ß√£o...";
              status.style.color = "#1976d2";
            });
          });
        } else {
          lista.innerHTML = "<p class='loading'>Ningu√©m confirmou ainda. Seja o primeiro! üíï</p>";
        }
        total.textContent = count;
      }, (error) => {
        lista.innerHTML = `<p style="color:red; text-align:center;">‚ùå Erro ao carregar: ${error.message}</p>`;
      });

      // ‚úÖ Enviar nova confirma√ß√£o
      enviarBtn.addEventListener("click", () => {
        const nome = nomeInput.value.trim();
        const acompanhantes = acompanhantesInput.value.trim() || "Apenas eu";

        if (!nome) {
          status.textContent = "‚ö†Ô∏è Por favor, digite seu nome.";
          return;
        }

        if (editandoId) {
          // Atualizar
          ref.child(editandoId).update({ nome, acompanhantes })
            .then(() => {
              resetForm();
              status.innerHTML = "‚úÖ Edi√ß√£o salva com sucesso!";
              status.style.color = "green";
            })
            .catch(err => {
              status.innerHTML = "‚ùå Erro ao editar: " + err.message;
            });
        } else {
          // Nova confirma√ß√£o
          ref.push({ nome, acompanhantes, timestamp: Date.now() })
            .then(() => {
              resetForm();
              status.innerHTML = "";
            })
            .catch(err => {
              status.innerHTML = "‚ùå Erro ao salvar: " + err.message;
            });
        }
      });

      // üîê Bot√£o de limpar tudo com senha
      document.getElementById("limparBtn").addEventListener("click", () => {
        const senha = prompt("üîí Digite a senha para limpar todas as confirma√ß√µes:");
        
        if (senha === "251125") {
          if (confirm("‚ö†Ô∏è Tem certeza que deseja apagar TODAS as confirma√ß√µes?")) {
            ref.remove()
              .then(() => {
                alert("‚úÖ Tudo limpo com sucesso!");
              })
              .catch(err => {
                alert("‚ùå Erro ao limpar: " + err.message);
              });
          }
        } else if (senha !== null) {
          alert("‚ùå Senha incorreta!");
        }
      });

      // Fun√ß√£o para resetar o formul√°rio
      function resetForm() {
        nomeInput.value = "";
        acompanhantesInput.value = "";
        editandoId = null;
        enviarBtn.innerHTML = "‚úÖ Confirmar Presen√ßa";
        formSection.style.display = "block";
        sucesso.style.display = "none";
      }

    } catch (error) {
      console.error("‚ùå Erro ao inicializar Firebase:", error);
      document.getElementById("status").textContent = "‚ùå Erro no Firebase: " + error.message;
      document.getElementById("status").style.color = "red";
    }
  </script>
</body>
</html>